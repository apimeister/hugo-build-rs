name: daily_version_check
on:
  workflow_dispatch:
jobs:
  daily_version_check:
    permissions: write-all
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: get hugo version
      run: |
        VERSION=`curl -L -H "Accept: application/vnd.github+json" -H "X-GitHub-Api-Version: 2022-11-28" 'https://api.github.com/repos/gohugoio/hugo/releases?per_page=1' | jq -r '.[].name'`
        HUGO_VERSION=${VERSION:1}
        echo "HUGO_VERSION=$HUGO_VERSION" >> $GITHUB_ENV
        echo $HUGO_VERSION
    - name: crate version
      run: |
        CRATE_VERSION=grep '^version =' Cargo.toml | cut -d'"' -f 2
        echo "CRATE_VERSION=$CRATE_VERSION" >> $GITHUB_ENV
        echo $CRATE_VERSION
    - name: replace version
      run: |
        sed -i '' 's/version \= \"$CRATE_VERSION\"/version \= \"HUGO_VERSION\"/' Cargo.toml
    - name: Build release artifact
      uses: actions-rs/cargo@v1
      with:
        command: build
        args: --release
